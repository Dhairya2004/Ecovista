<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>QR Code Scanner</title>
    <style>
        #qr-video {
            width: 100%;
            height: 100%;
        }
        #qr-canvas {
            display: none;
        }
        .scan {
            width: 100%;
            max-width: 600px;
            margin: auto;
            position: relative;
            overflow: hidden;
            display: none; /* Initially hide the scanner */
        }
        .scan::before {
            content: "";
            position: absolute;
            top: -100%;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.5);
            animation: scan 2s infinite linear;
        }
        @keyframes scan {
            from {
                top: -100%;
            }
            to {
                top: 100%;
            }
        }
        .illustration {
            width: 100%;
            max-width: 600px;
            margin: auto;
        }
        .center-content {
            text-align: center;
        }
        .btn {
            border: 2px solid gray;
            color: gray;
            background-color: white;
            padding: 8px 20px;
            border-radius: 8px;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
        }
        #fileInput {
            display: none;
        }
        .upload-btn-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }
        .upload-btn-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
        }
        .uploaded-image {
            width: 100%;
            max-width: 600px;
            margin: auto;
            animation: fadeInOut 2s infinite; /* Fade in and out animation */
        }
        @keyframes fadeInOut {
            0%, 100% {
                opacity: 0;
            }
            50% {
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="center-content">
        <button class="btn" onclick="startScanning()">Scan Me</button>
        <div class="upload-btn-wrapper">
            <button class="btn" onclick="document.getElementById('fileInput').click()">Upload Image</button>
            <input type="file" id="fileInput" accept="image/*" onchange="handleFile()" style="cursor: pointer;">
        </div>
        <div class="illustration">
            <img src="https://storage.googleapis.com/support-kms-prod/mQmcrC93Ryi2U4x5UdZNeyHQMybbyk71yCVm" alt="Illustration">
        </div>
        <div class="scan">
            <video id="qr-video" alt="QR Code Scanner"></video>
            <p id="loadingMessage">Click 'Scan Me' to start scanning.</p>
        </div>
        <div class="uploaded-image" id="uploadedImageContainer">
            <img id="previewImage" alt="Uploaded Image Preview">
            <p id="loadingMessageUpload">Scanning image...</p>
        </div>
    </div>

    <script src="https://rawgit.com/sitepoint-editors/jsqrcode/master/src/qr_packed.js"></script>
    <!-- (Include other script sources as before) -->

    <script type="text/javascript">
        var video = document.querySelector("#qr-video");
        var canvasElement = document.createElement("canvas"); // Create a canvas element
        var canvas = canvasElement.getContext("2d");
        var loadingMessage = document.getElementById("loadingMessage");
        var illustrationContainer = document.querySelector('.illustration');
        var scanContainer = document.querySelector('.scan');
        var fileInput = document.getElementById('fileInput');
        var previewImage = document.getElementById('previewImage');
        var uploadedImageContainer = document.getElementById('uploadedImageContainer');
        var loadingMessageUpload = document.getElementById('loadingMessageUpload');

        function startScanning() {
            illustrationContainer.style.display = 'none'; // Hide the illustration
            scanContainer.style.display = 'block'; // Show the scanner
            fileInput.value = ''; // Reset file input value
            uploadedImageContainer.style.display = 'none'; // Hide uploaded image container
            navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(function(stream) {
                video.srcObject = stream;
                video.setAttribute("playsinline", true);
                video.play();
                var scanDuration = Math.floor(Math.random() * (5000 - 3000 + 1)) + 3000; // Random duration between 3 to 5 seconds
                setTimeout(function() {
                    video.pause();
                    loadingMessage.innerText = "üì∑ Scanning complete!";
                    displayRandomNumber();
                    setTimeout(resetScanning, 2000); // Reset scanning after 2 seconds
                }, scanDuration);
                requestAnimationFrame(tick);
                loadingMessage.innerText = "üì∑ Scanning...";
            }).catch(function(error) {
                console.error("Error accessing camera:", error);
                loadingMessage.innerText = "‚ùå Unable to access camera. Please check your settings.";
            });
        }

        function handleFile() {
            const file = fileInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImage.src = e.target.result;
                    fitImageWithinDimensions();
                    uploadedImageContainer.style.display = 'block'; // Show uploaded image container
                    illustrationContainer.style.display = 'none'; // Hide the illustration
                    scanContainer.style.display = 'block'; // Show the scanner
                    loadingMessageUpload.innerText = "üì∑ Scanning image...";
                    setTimeout(function() {
                        loadingMessageUpload.innerText = "Image scanned successfully!";
                        displayRandomNumber();
                        setTimeout(resetScanning, 2000); // Reset scanning after 2 seconds
                    }, 3000); // Simulate scanning time for the image
                };
                reader.readAsDataURL(file);
            }
        }

        function fitImageWithinDimensions() {
            var maxWidth = scanContainer.clientWidth;
            var maxHeight = scanContainer.clientHeight;
            var widthRatio = maxWidth / previewImage.width;
            var heightRatio = maxHeight / previewImage.height;
            var minRatio = Math.min(widthRatio, heightRatio);
            previewImage.width = previewImage.width * minRatio;
            previewImage.height = previewImage.height * minRatio;
        }

        function tick() {
            if (video.readyState === video.HAVE_ENOUGH_DATA) {
                canvasElement.width = video.videoWidth;
                canvasElement.height = video.videoHeight;
                canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
                try {
                    qrcode.decode();
                } catch (e) {
                    setTimeout(tick, 1000);
                    return;
                }
            }
            requestAnimationFrame(tick);
        }

        qrcode.callback = function(result) {
            alert("Scanned QR Code: " + result);
        };

        function displayRandomNumber() {
            var randomNumber = Math.floor(Math.random() * (12 - 10 + 1)) + 10; // Random number between 10 and 12
            alert("Random Number: " + randomNumber);
            scanContainer.style.display = 'none'; // Hide the scanner
            illustrationContainer.style.display = 'block'; // Show the illustration
        }

        function resetScanning() {
            scanContainer.style.display = 'none'; // Hide the scanner
            illustrationContainer.style.display = 'block'; // Show the illustration
            loadingMessage.innerText = "Click 'Scan Me' to start scanning.";
            video.currentTime = 0;

            uploadedImageContainer.style.display = 'none'; // Hide uploaded image container
            previewImage.src = ''; // Reset uploaded image preview
            loadingMessageUpload.innerText = ''; // Reset upload message
        }
    </script>

</body>
</html>
